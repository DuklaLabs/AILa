<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <title>DuklaLabs ‚Äì Admin panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #0f172a;
      --bg-alt: #020617;
      --card-bg: #020617;
      --accent: #ef4444;
      --accent-soft: rgba(239, 68, 68, 0.1);
      --accent-strong: rgba(239, 68, 68, 0.2);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border: #1f2937;
      --radius-lg: 16px;
      --radius-md: 10px;
      --shadow-card: 0 18px 45px rgba(0, 0, 0, 0.55);
      --shadow-soft: 0 10px 30px rgba(0, 0, 0, 0.45);
      --transition-fast: 150ms ease-out;
      --transition: 200ms ease;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 24px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #020617 45%, #000 100%);
      color: var(--text);
      min-height: 100vh;
    }

    .app-shell {
      max-width: 1120px;
      margin: 0 auto;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 24px;
    }

    .header-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 38px;
      height: 38px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #f97316 0, #ef4444 40%, #7f1d1d 100%);
      box-shadow: 0 10px 30px rgba(239, 68, 68, 0.4);
      font-weight: 800;
      letter-spacing: 0.06em;
    }

    .logo-pill span {
      font-size: 14px;
    }

    h1 {
      margin: 0;
      font-size: 24px;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .subtitle {
      margin: 0;
      font-size: 13px;
      color: var(--muted);
    }

    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      font-size: 11px;
      color: var(--muted);
      background: radial-gradient(circle at top, rgba(148, 163, 184, 0.18), transparent);
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }

    .tab {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid transparent;
      background: rgba(15, 23, 42, 0.7);
      color: var(--muted);
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: var(--transition-fast);
    }

    .tab span.icon {
      font-size: 14px;
    }

    .tab.active {
      color: #f9fafb;
      border-color: var(--accent);
      background: linear-gradient(
        135deg,
        rgba(239, 68, 68, 0.12),
        rgba(15, 23, 42, 0.9)
      );
      box-shadow: 0 12px 30px rgba(239, 68, 68, 0.35);
    }

    .tab:not(.active):hover {
      border-color: rgba(148, 163, 184, 0.5);
      transform: translateY(-1px);
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2fr);
      gap: 16px;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: radial-gradient(circle at top left, #111827 0, #020617 55%);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(31, 41, 55, 0.9);
      box-shadow: var(--shadow-card);
      padding: 16px 16px 14px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(
        circle at top right,
        rgba(239, 68, 68, 0.15),
        transparent 55%
      );
      opacity: 0.9;
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
    }

    .card-title {
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-title-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 16px rgba(239, 68, 68, 0.8);
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--muted);
    }

    .pill-status {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--muted);
      background: rgba(2, 6, 23, 0.9);
    }

    .pill-status.online {
      border-color: rgba(34, 197, 94, 0.7);
      color: #bbf7d0;
      background: radial-gradient(circle at top, rgba(34, 197, 94, 0.18), transparent);
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    label {
      font-size: 12px;
      display: block;
      margin-bottom: 4px;
      color: var(--muted);
    }

    input,
    select,
    textarea {
      width: 100%;
      background: rgba(15, 23, 42, 0.85);
      border-radius: 10px;
      border: 1px solid rgba(30, 64, 175, 0.6);
      padding: 7px 9px;
      font-size: 13px;
      color: var(--text);
      outline: none;
      transition: var(--transition-fast);
    }

    input::placeholder,
    textarea::placeholder {
      color: rgba(148, 163, 184, 0.5);
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(239, 68, 68, 0.5);
      background: rgba(15, 23, 42, 0.9);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
      max-height: 260px;
    }

    .btn-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid transparent;
      font-size: 13px;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ef4444, #f97316);
      color: #f9fafb;
      box-shadow: 0 12px 30px rgba(239, 68, 68, 0.45);
    }

    .btn-primary:hover {
      transform: translateY(-1px) translateZ(0);
      box-shadow: 0 18px 40px rgba(239, 68, 68, 0.55);
      filter: saturate(1.05);
    }

    .btn-ghost {
      background: rgba(15, 23, 42, 0.8);
      color: var(--muted);
      border-color: rgba(148, 163, 184, 0.5);
    }

    .btn-ghost:hover {
      border-color: var(--accent);
      color: #e5e7eb;
      transform: translateY(-1px);
    }

    .btn-icon {
      font-size: 14px;
    }

    .helper-text {
      font-size: 11px;
      color: var(--muted);
    }

    .table-wrapper {
      margin-top: 12px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: radial-gradient(circle at top left, #020617 0, #020617 60%);
      max-height: 260px;
      overflow: hidden;
      box-shadow: var(--shadow-soft);
    }

    .table-header,
    .table-row {
      display: grid;
      grid-template-columns: 1.2fr 1.1fr 0.7fr 0.5fr 0.6fr;
      padding: 6px 10px;
      font-size: 12px;
      align-items: center;
    }

    @media (max-width: 840px) {
      .table-header,
      .table-row {
        grid-template-columns: 1.4fr 1.1fr 0.7fr 0.5fr;
      }
      .table-header .col-notes,
      .table-row .col-notes {
        display: none;
      }
    }

    .table-header {
      background: rgba(15, 23, 42, 0.95);
      border-bottom: 1px solid rgba(31, 41, 55, 0.95);
      position: sticky;
      top: 0;
      z-index: 2;
    }

    .table-header span {
      color: var(--muted);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .table-body {
      max-height: 210px;
      overflow-y: auto;
    }

    .table-row:nth-child(2n) {
      background: rgba(15, 23, 42, 0.8);
    }

    .table-row:nth-child(2n + 1) {
      background: rgba(15, 23, 42, 0.6);
    }

    .badge-soft {
      padding: 3px 7px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      color: var(--muted);
      background: rgba(2, 6, 23, 0.9);
      justify-self: flex-start;
    }

    .badge-soft.red {
      border-color: rgba(239, 68, 68, 0.7);
      color: #fecaca;
      background: rgba(127, 29, 29, 0.7);
    }

    .badge-soft.green {
      border-color: rgba(34, 197, 94, 0.7);
      color: #bbf7d0;
      background: rgba(22, 101, 52, 0.8);
    }

    .badge-soft.yellow {
      border-color: rgba(234, 179, 8, 0.7);
      color: #fef9c3;
      background: rgba(113, 63, 18, 0.85);
    }

    .logs {
      margin-top: 8px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(31, 41, 55, 0.95);
      background: radial-gradient(circle at top left, #020617 0, #020617 60%);
      max-height: 305px;
      overflow: hidden;
      box-shadow: var(--shadow-soft);
      font-size: 12px;
    }

    .logs-header {
      padding: 6px 10px;
      border-bottom: 1px solid rgba(31, 41, 55, 0.95);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      background: rgba(15, 23, 42, 0.96);
    }

    .logs-header-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
    }

    .logs-body {
      max-height: 260px;
      overflow-y: auto;
      padding: 6px 8px;
    }

    .log-item {
      border-radius: 10px;
      padding: 6px 8px;
      margin-bottom: 6px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    .log-item:last-child {
      margin-bottom: 2px;
    }

    .log-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 3px;
      font-size: 11px;
      color: var(--muted);
    }

    .log-message {
      font-size: 12px;
      line-height: 1.4;
      color: #e5e7eb;
      white-space: pre-wrap;
    }

    .log-badge {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .log-badge.info {
      border-color: rgba(59, 130, 246, 0.7);
      color: #bfdbfe;
    }

    .log-badge.warn {
      border-color: rgba(234, 179, 8, 0.7);
      color: #fef9c3;
    }

    .log-badge.error {
      border-color: rgba(239, 68, 68, 0.8);
      color: #fecaca;
    }

    .status-bar {
      margin-top: 8px;
      font-size: 11px;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.9);
    }

    .status-dot.offline {
      background: #f97316;
      box-shadow: 0 0 12px rgba(249, 115, 22, 0.9);
    }

    .status-dot.error {
      background: var(--accent);
      box-shadow: 0 0 12px rgba(239, 68, 68, 0.9);
    }

    .toast {
      position: fixed;
      right: 16px;
      bottom: 16px;
      min-width: 220px;
      max-width: 320px;
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 12px;
      background: radial-gradient(circle at top left, #111827 0, #020617 100%);
      border: 1px solid rgba(31, 41, 55, 0.95);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.8);
      color: #e5e7eb;
      display: none;
      z-index: 999;
    }

    .toast.visible {
      display: block;
      animation: slide-up 200ms ease-out;
    }

    .toast-title {
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 12px;
    }

    .toast-body {
      font-size: 11px;
      color: var(--muted);
    }

    .toast-ok {
      border-left: 3px solid #22c55e;
    }

    .toast-error {
      border-left: 3px solid var(--accent);
    }

    @keyframes slide-up {
      from {
        transform: translateY(10px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="header">
      <div class="header-left">
        <div class="title-row">
          <div class="logo-pill"><span>DL</span></div>
          <h1>DuklaLabs ‚Äì Admin</h1>
        </div>
        <p class="subtitle">Spr√°va otev√≠rac√≠ch hodin a notifikac√≠ AI agenta pro p≈ô√≠stupov√Ω syst√©m.</p>
      </div>
      <div class="badge">GitHub Pages ¬∑ statick√° verze UI</div>
    </header>

    <nav class="tabs">
      <button class="tab active" data-tab="hours">
        <span class="icon">üïí</span>
        Otev√≠rac√≠ hodiny
      </button>
      <button class="tab" data-tab="agent-log">
        <span class="icon">ü§ñ</span>
        Zpr√°vy agenta
      </button>
      <button class="tab" data-tab="agent-chat">
        <span class="icon">üí¨</span>
        Dotaz na agenta
      </button>
    </nav>

    <main>
      <!-- TAB: Otev√≠rac√≠ hodiny -->
      <section id="tab-hours" class="grid">
        <div class="card">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <div class="card-title">
                  <span class="card-title-dot"></span>
                  Nov√Ω slot otev√≠rac√≠ch hodin
                </div>
                <div class="card-subtitle">
                  Zadej term√≠n, ƒçasov√Ω rozsah a maxim√°ln√≠ poƒçet osob. Po odesl√°n√≠ se zavol√° n8n workflow.
                </div>
              </div>
              <span class="pill-status online" id="status-api-hours">API p≈ôipraveno</span>
            </div>

            <form id="openHoursForm">
              <div class="form-row">
                <div>
                  <label for="date">Datum</label>
                  <input id="date" type="date" required />
                </div>
                <div>
                  <label for="timeFrom">Od</label>
                  <input id="timeFrom" type="time" required />
                </div>
                <div>
                  <label for="timeTo">Do</label>
                  <input id="timeTo" type="time" required />
                </div>
              </div>

              <div class="form-row">
                <div>
                  <label for="capacity">Kapacita</label>
                  <input
                    id="capacity"
                    type="number"
                    min="1"
                    step="1"
                    placeholder="nap≈ô. 10"
                    required
                  />
                </div>
                <div>
                  <label for="location">M√≠sto / uƒçebna</label>
                  <input
                    id="location"
                    type="text"
                    placeholder="nap≈ô. DuklaLabs / Lab 1"
                  />
                </div>
                <div>
                  <label for="type">Typ slotu</label>
                  <select id="type">
                    <option value="standard">Standardn√≠</option>
                    <option value="workshop">Workshop</option>
                    <option value="uzavrene">Uzav≈ôen√° akce</option>
                  </select>
                </div>
              </div>

              <div>
                <label for="notes">Pozn√°mka (voliteln√©)</label>
                <textarea
                  id="notes"
                  placeholder="nap≈ô. preferuj√≠ se studenti 3. roƒçn√≠ku, max. 1 t√Ωm / firma apod."
                ></textarea>
              </div>

              <div class="btn-row">
                <button type="submit" class="btn btn-primary">
                  <span class="btn-icon">‚úÖ</span>
                  Ulo≈æit slot (n8n ‚Üí Postgres)
                </button>
                <button type="button" class="btn btn-ghost" id="reloadSlotsBtn">
                  <span class="btn-icon">üîÑ</span>
                  Naƒç√≠st aktu√°ln√≠ sloty
                </button>
              </div>
              <p class="helper-text">
                P≈ôi ulo≈æen√≠ oƒçek√°v√° UI JSON odpovƒõƒè z n8n (status, p≈ô√≠padn√© zpr√°vy agenta).
              </p>
            </form>

            <div class="table-wrapper" id="slotsTableWrapper">
              <div class="table-header">
                <span>Datum</span>
                <span>ƒåas</span>
                <span>Kapacita</span>
                <span>Typ</span>
                <span class="col-notes">Pozn√°mka</span>
              </div>
              <div class="table-body" id="slotsTableBody">
                <!-- Sloty se dopln√≠ dynamicky -->
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <div class="card-title">
                  <span class="card-title-dot"></span>
                  Shrnut√≠ od agenta
                </div>
                <div class="card-subtitle">
                  Posledn√≠ zpr√°vy o zmƒõn√°ch kapacit, zaplnƒõnosti a doporuƒçen√≠ pro √∫pravu slot≈Ø.
                </div>
              </div>
              <span class="pill-status" id="status-agent-hours">ƒåek√°m na data‚Ä¶</span>
            </div>

            <div class="logs" id="agentSummaryBox">
              <div class="logs-header">
                <div class="logs-header-title">Posledn√≠ odpovƒõƒè agenta</div>
                <button class="btn btn-ghost" id="refreshAgentSummaryBtn">
                  <span class="btn-icon">üîÅ</span>
                  Aktualizovat
                </button>
              </div>
              <div class="logs-body" id="agentSummaryBody">
                <div class="log-item">
                  <div class="log-meta">
                    <span>‚Äì</span>
                    <span class="log-badge info">INFO</span>
                  </div>
                  <div class="log-message">
                    Zat√≠m ≈æ√°dn√° odpovƒõƒè. Klikni na ‚ÄûAktualizovat‚Äú po prvn√≠m vol√°n√≠ workflow.
                  </div>
                </div>
              </div>
            </div>

            <div class="status-bar">
              <span class="status-dot" id="status-dot-agent-hours"></span>
              <span id="status-text-agent-hours">
                Agent p≈ôipraven logovat zmƒõny po integraci s n8n workflow <code>config_open_hours</code>.
              </span>
            </div>
          </div>
        </div>
      </section>

      <!-- TAB: Zpr√°vy agenta -->
      <section id="tab-agent-log" class="grid hidden">
        <div class="card" style="grid-column: 1 / -1;">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <div class="card-title">
                  <span class="card-title-dot"></span>
                  Zpr√°vy a varov√°n√≠ agenta
                </div>
                <div class="card-subtitle">
                  Agent sem m≈Ø≈æe pos√≠lat informace o p≈ôet√≠≈æen√Ωch term√≠nech, n√°vrhy na nav√Ω≈°en√≠ kapacity
                  nebo slouƒçen√≠ slot≈Ø apod.
                </div>
              </div>
              <span class="pill-status" id="status-agent-log">Naƒç√≠t√°m‚Ä¶</span>
            </div>

            <div class="logs" id="agentLogs">
              <div class="logs-header">
                <div class="logs-header-title">Historie zpr√°v</div>
                <div class="btn-row" style="margin-top: 0;">
                  <button class="btn btn-ghost" id="refreshAgentLogBtn">
                    <span class="btn-icon">üîÅ</span>
                    Aktualizovat
                  </button>
                </div>
              </div>
              <div class="logs-body" id="agentLogsBody">
                <!-- Logy se dopln√≠ dynamicky -->
              </div>
            </div>

            <div class="status-bar">
              <span class="status-dot offline" id="status-dot-agent-log"></span>
              <span id="status-text-agent-log">
                Po integraci n8n &rarr; Postgres &rarr; agent &rarr; webhook sem m≈Ø≈æe≈° tahat v≈°echna doporuƒçen√≠.
              </span>
            </div>
          </div>
        </div>
      </section>

      <!-- TAB: Dotaz na agenta -->
      <section id="tab-agent-chat" class="grid hidden">
        <div class="card">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <div class="card-title">
                  <span class="card-title-dot"></span>
                  Rychl√Ω dotaz na agenta
                </div>
                <div class="card-subtitle">
                  Po≈°li vlastn√≠ instrukci, agent m≈Ø≈æe pou≈æ√≠t n√°stroje (dotazy do Postgresu atd.) a vr√°t√≠ odpovƒõƒè.
                </div>
              </div>
              <span class="pill-status" id="status-agent-chat">P≈ôipraven</span>
            </div>

            <div>
              <label for="agentPrompt">Dotaz / instrukce</label>
              <textarea
                id="agentPrompt"
                placeholder="Nap≈ô.: Zkontroluj posledn√≠ 4 term√≠ny u st≈ôedeƒçn√≠ch otev≈ôen√Ωch hodin a navrhni, zda nav√Ω≈°it kapacitu."
              ></textarea>
            </div>

            <div class="btn-row">
              <button class="btn btn-primary" id="sendAgentPromptBtn">
                <span class="btn-icon">üöÄ</span>
                Odeslat agentovi
              </button>
              <span class="helper-text" id="agentChatHint">
                Po integraci s n8n nastav webhook tak, aby zpr√°vu poslal lok√°ln√≠mu modelu a odpovƒõƒè vr√°til jako JSON.
              </span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-inner">
            <div class="card-header">
              <div>
                <div class="card-title">
                  <span class="card-title-dot"></span>
                  Odpovƒõƒè agenta
                </div>
                <div class="card-subtitle">
                  Zde se zobraz√≠ strukturovan√° odpovƒõƒè ‚Äì m≈Ø≈æe≈° v n√≠ zobrazit i doporuƒçen√© zmƒõny slot≈Ø.
                </div>
              </div>
            </div>

            <div class="logs">
              <div class="logs-header">
                <div class="logs-header-title">Posledn√≠ odpovƒõƒè</div>
                <div class="helper-text">Oƒçek√°v√° se JSON z n8n, UI vyp√≠≈°e textovou ƒç√°st.</div>
              </div>
              <div class="logs-body" id="agentChatResponseBody">
                <div class="log-item">
                  <div class="log-meta">
                    <span>‚Äì</span>
                    <span class="log-badge info">INFO</span>
                  </div>
                  <div class="log-message">
                    Zat√≠m ≈æ√°dn√° zpr√°va. Po≈°li dotaz agentovi vlevo.
                  </div>
                </div>
              </div>
            </div>

            <div class="status-bar">
              <span class="status-dot" id="status-dot-agent-chat"></span>
              <span id="status-text-agent-chat">
                P≈ôipraveno na napojen√≠ ‚Äì nastav jen URL webhooku v sekci JavaScriptu dole v souboru.
              </span>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Toast notifikace -->
  <div id="toast" class="toast">
    <div class="toast-title" id="toastTitle"></div>
    <div class="toast-body" id="toastBody"></div>
  </div>

  <script>
    // -------------------------------------------------------------------------
    // 1) KONFIGURACE API ‚Äì DOPL≈á SI VLASTN√ç URL n8n / webhook≈Ø
    // -------------------------------------------------------------------------
    const API_CONFIG = {
      // Workflow pro ukl√°d√°n√≠/aktualizaci slot≈Ø otev√≠rac√≠ch hodin
      SAVE_SLOT_URL:
        "http://localhost:8003/config-open-hours", // TODO: zmƒõ≈à na re√°lnou URL

      // Endpoint pro naƒçten√≠ v≈°ech slot≈Ø z Postgresu
      LIST_SLOTS_URL:
        "http://localhost:8003/admin_list_slots", // TODO: zmƒõ≈à na re√°lnou URL
      // Endpoint, kter√Ω vrac√≠ posledn√≠ shrnut√≠ od agenta k open_hours
      AGENT_SUMMARY_URL:
        "http://localhost:8003/admin_agent_summary", // TODO: zmƒõ≈à na re√°lnou URL

      // Endpoint, kter√Ω vrac√≠ del≈°√≠ log (historii) zpr√°v agenta
      AGENT_LOG_URL:
        "http://localhost:8003/admin_agent_log", // TODO: zmƒõ≈à na re√°lnou URL
      // Endpoint pro ad-hoc dotazy na agenta
      AGENT_CHAT_URL:
        "http://localhost:8003/admin_agent_chat", // TODO: zmƒõ≈à na re√°lnou URL
    };

    // Pomocn√© funkce pro UI ---------------------------------------------------
    function showToast(title, message, isError = false) {
      const toast = document.getElementById("toast");
      const toastTitle = document.getElementById("toastTitle");
      const toastBody = document.getElementById("toastBody");

      toastTitle.textContent = title;
      toastBody.textContent = message;

      toast.classList.remove("toast-ok", "toast-error");
      toast.classList.add(isError ? "toast-error" : "toast-ok");
      toast.classList.add("visible");

      setTimeout(() => {
        toast.classList.remove("visible");
      }, 3500);
    }

    async function safeFetch(url, options = {}) {
      try {
        const res = await fetch(url, {
          headers: {
            "Content-Type": "application/json",
          },
          ...options,
        });

        if (!res.ok) {
          const text = await res.text();
          throw new Error(
            `HTTP ${res.status} ‚Äì ${res.statusText || "Nezn√°m√° chyba"} (${text})`
          );
        }

        const contentType = res.headers.get("content-type") || "";
        if (contentType.includes("application/json")) {
          return await res.json();
        }
        // Pokud vrac√≠ plain text, vra≈• jako { raw: ... }
        const raw = await res.text();
        return { raw };
      } catch (err) {
        console.error("API error:", err);
        throw err;
      }
    }

    // P≈ôep√≠n√°n√≠ tab≈Ø ----------------------------------------------------------
    const tabButtons = document.querySelectorAll(".tab");
    const tabSections = {
      hours: document.getElementById("tab-hours"),
      "agent-log": document.getElementById("tab-agent-log"),
      "agent-chat": document.getElementById("tab-agent-chat"),
    };

    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const tabId = btn.dataset.tab;

        tabButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");

        Object.entries(tabSections).forEach(([id, section]) => {
          if (id === tabId) section.classList.remove("hidden");
          else section.classList.add("hidden");
        });
      });
    });

    // -------------------------------------------------------------------------
    // 2) OTEV√çRAC√ç HODINY ‚Äì odesl√°n√≠ slotu + naƒç√≠t√°n√≠ tabulky
    // -------------------------------------------------------------------------
    const openHoursForm = document.getElementById("openHoursForm");
    const slotsTableBody = document.getElementById("slotsTableBody");
    const reloadSlotsBtn = document.getElementById("reloadSlotsBtn");

    openHoursForm.addEventListener("submit", async (event) => {
      event.preventDefault();

      const date = document.getElementById("date").value;
      const timeFrom = document.getElementById("timeFrom").value;
      const timeTo = document.getElementById("timeTo").value;
      const capacity = document.getElementById("capacity").valueAsNumber;
      const location = document.getElementById("location").value.trim();
      const type = document.getElementById("type").value;
      const notes = document.getElementById("notes").value.trim();

      if (!date || !timeFrom || !timeTo || !capacity) {
        showToast("Chyba", "Vypl≈à pros√≠m datum, ƒçasy a kapacitu.", true);
        return;
      }

      const payload = {
        date,
        time_from: timeFrom,
        time_to: timeTo,
        capacity,
        location: location || null,
        type,
        notes: notes || null,
        source: "admin.html",
      };

      try {
        const statusBadge = document.getElementById("status-api-hours");
        statusBadge.textContent = "Odes√≠l√°m‚Ä¶";
        statusBadge.classList.remove("online");

        const data = await safeFetch(API_CONFIG.SAVE_SLOT_URL, {
          method: "POST",
          body: JSON.stringify(payload),
        });

        // Oƒçek√°van√Ω form√°t z n8n ‚Äì p≈ôizp≈Øsob podle sebe:
        // { ok: true, message: "Ulo≈æeno", agent_summary: "..." }
        const ok = !!(data.ok ?? true);
        const message =
          data.message ||
          (ok
            ? "Slot byl odesl√°n do workflow. Zkontroluj logy agenta."
            : "Slot se nepoda≈ôilo ulo≈æit.");

        showToast(ok ? "Hotovo" : "Chyba", message, !ok);

        // Pokud je souƒç√°st√≠ odpovƒõdi i shrnut√≠ od agenta, zobraz ho
        if (data.agent_summary) {
          renderAgentSummary({
            timestamp: new Date().toISOString(),
            severity: "info",
            message: data.agent_summary,
          });
        }

        statusBadge.textContent = "API p≈ôipraveno";
        statusBadge.classList.add("online");

        // Refresh tabulky slot≈Ø
        await loadSlots();
      } catch (err) {
        showToast("Chyba API", err.message || String(err), true);
        const statusBadge = document.getElementById("status-api-hours");
        statusBadge.textContent = "Chyba API";
        statusBadge.classList.remove("online");
      }
    });

    reloadSlotsBtn.addEventListener("click", () => {
      loadSlots();
    });

    async function loadSlots() {
      slotsTableBody.innerHTML =
        '<div style="padding: 8px; font-size: 12px; color: #9ca3af;">Naƒç√≠t√°m sloty‚Ä¶</div>';
      try {
        const data = await safeFetch(API_CONFIG.LIST_SLOTS_URL, {
          method: "GET",
        });

        // Oƒçek√°van√Ω form√°t:
        // { slots: [ { id, date, time_from, time_to, capacity, type, notes } ] }
        const slots = data.slots || [];
        if (!slots.length) {
          slotsTableBody.innerHTML =
            '<div style="padding: 8px; font-size: 12px; color: #9ca3af;">Zat√≠m nejsou ≈æ√°dn√© sloty.</div>';
          return;
        }

        slotsTableBody.innerHTML = "";

        slots.forEach((slot) => {
          const row = document.createElement("div");
          row.className = "table-row";

          const range = `${slot.time_from ?? ""} ‚Äì ${slot.time_to ?? ""}`;
          const type = slot.type ?? "standard";
          const notes = slot.notes ?? "";

          row.innerHTML = `
            <span>${slot.date ?? ""}</span>
            <span>${range}</span>
            <span>${slot.capacity ?? "-"}</span>
            <span>
              <span class="badge-soft">${
                type === "standard"
                  ? "Standard"
                  : type === "workshop"
                  ? "Workshop"
                  : "Uzav≈ôen√©"
              }</span>
            </span>
            <span class="col-notes" style="font-size:11px; color:#9ca3af;">
              ${notes ? notes : "‚Äì"}
            </span>
          `;

          slotsTableBody.appendChild(row);
        });
      } catch (err) {
        slotsTableBody.innerHTML =
          '<div style="padding: 8px; font-size: 12px; color: #fecaca;">Nepoda≈ôilo se naƒç√≠st sloty ‚Äì zkontroluj URL a CORS nastaven√≠ n8n.</div>';
      }
    }

    // -------------------------------------------------------------------------
    // 3) AGENT ‚Äì shrnut√≠ k open_hours
    // -------------------------------------------------------------------------
    const agentSummaryBody = document.getElementById("agentSummaryBody");
    const refreshAgentSummaryBtn = document.getElementById(
      "refreshAgentSummaryBtn"
    );

    function renderAgentSummary(entry) {
      const { timestamp, severity = "info", message } = entry;

      const item = document.createElement("div");
      item.className = "log-item";

      const badgeClass =
        severity === "error"
          ? "error"
          : severity === "warn"
          ? "warn"
          : "info";

      item.innerHTML = `
        <div class="log-meta">
          <span>${timestamp ? new Date(timestamp).toLocaleString("cs-CZ") : "-"}</span>
          <span class="log-badge ${badgeClass}">${severity.toUpperCase()}</span>
        </div>
        <div class="log-message">${message || ""}</div>
      `;

      agentSummaryBody.innerHTML = "";
      agentSummaryBody.appendChild(item);

      const statusText = document.getElementById("status-text-agent-hours");
      const statusDot = document.getElementById("status-dot-agent-hours");
      statusDot.classList.remove("offline", "error");
      statusText.textContent = "Posledn√≠ shrnut√≠ bylo naƒçteno z agenta.";
    }

    async function loadAgentSummary() {
      const statusBadge = document.getElementById("status-agent-hours");
      const statusDot = document.getElementById("status-dot-agent-hours");
      const statusText = document.getElementById("status-text-agent-hours");

      statusBadge.textContent = "Naƒç√≠t√°m‚Ä¶";
      statusDot.classList.add("offline");

      try {
        const data = await safeFetch(API_CONFIG.AGENT_SUMMARY_URL, {
          method: "GET",
        });

        // Oƒçek√°van√Ω form√°t:
        // { timestamp: "...", severity: "info"|"warn"|"error", message: "..." }
        if (data && (data.message || data.raw)) {
          renderAgentSummary({
            timestamp: data.timestamp ?? new Date().toISOString(),
            severity: data.severity ?? "info",
            message: data.message ?? data.raw,
          });
        } else {
          agentSummaryBody.innerHTML =
            '<div class="log-item"><div class="log-message">Agent zat√≠m neposlal ≈æ√°dn√© shrnut√≠.</div></div>';
        }

        statusBadge.textContent = "OK";
        statusDot.classList.remove("offline", "error");
        statusText.textContent = "Agent vrac√≠ shrnut√≠ ‚Äì nastaven√≠ vypad√° v po≈ô√°dku.";
      } catch (err) {
        console.error(err);
        statusBadge.textContent = "Chyba";
        statusDot.classList.add("error");
        agentSummaryBody.innerHTML =
          '<div class="log-item"><div class="log-message" style="color:#fecaca;">Nepoda≈ôilo se naƒç√≠st shrnut√≠ od agenta. Zkontroluj URL a backend.</div></div>';
        statusText.textContent =
          "Chyba komunikace s agentem ‚Äì zkontroluj n8n workflow a URL.";
      }
    }

    refreshAgentSummaryBtn.addEventListener("click", () => {
      loadAgentSummary();
    });

    // -------------------------------------------------------------------------
    // 4) AGENT ‚Äì log (historie zpr√°v)
    // -------------------------------------------------------------------------
    const agentLogsBody = document.getElementById("agentLogsBody");
    const refreshAgentLogBtn = document.getElementById("refreshAgentLogBtn");

    function renderAgentLogs(entries) {
      agentLogsBody.innerHTML = "";
      if (!entries || !entries.length) {
        agentLogsBody.innerHTML =
          '<div class="log-item"><div class="log-message">Zat√≠m nejsou ≈æ√°dn√© logy od agenta.</div></div>';
        return;
      }

      entries.forEach((entry) => {
        const { timestamp, severity = "info", message } = entry;
        const badgeClass =
          severity === "error"
            ? "error"
            : severity === "warn"
            ? "warn"
            : "info";

        const item = document.createElement("div");
        item.className = "log-item";
        item.innerHTML = `
          <div class="log-meta">
            <span>${timestamp ? new Date(timestamp).toLocaleString("cs-CZ") : "-"}</span>
            <span class="log-badge ${badgeClass}">${severity.toUpperCase()}</span>
          </div>
          <div class="log-message">${message || ""}</div>
        `;
        agentLogsBody.appendChild(item);
      });
    }

    async function loadAgentLogs() {
      const statusBadge = document.getElementById("status-agent-log");
      const statusDot = document.getElementById("status-dot-agent-log");
      const statusText = document.getElementById("status-text-agent-log");

      statusBadge.textContent = "Naƒç√≠t√°m‚Ä¶";
      statusDot.classList.add("offline");

      try {
        const data = await safeFetch(API_CONFIG.AGENT_LOG_URL, {
          method: "GET",
        });

        // Oƒçek√°van√Ω form√°t:
        // { logs: [ { timestamp, severity, message }, ... ] }
        const logs = data.logs || [];
        renderAgentLogs(logs);

        statusBadge.textContent = "OK";
        statusDot.classList.remove("offline", "error");
        statusText.textContent = "Logy agenta naƒçteny.";
      } catch (err) {
        console.error(err);
        statusBadge.textContent = "Chyba";
        statusDot.classList.add("error");
        agentLogsBody.innerHTML =
          '<div class="log-item"><div class="log-message" style="color:#fecaca;">Nepoda≈ôilo se naƒç√≠st logy ‚Äì zkontroluj URL a backend.</div></div>';
        statusText.textContent =
          "Chyba komunikace ‚Äì ujisti se, ≈æe n8n zapisuje logy a endpoint je p≈ô√≠stupn√Ω z GitHub Pages (CORS).";
      }
    }

    refreshAgentLogBtn.addEventListener("click", () => {
      loadAgentLogs();
    });

    // -------------------------------------------------------------------------
    // 5) AGENT ‚Äì ad-hoc dotazy
    // -------------------------------------------------------------------------
    const sendAgentPromptBtn = document.getElementById("sendAgentPromptBtn");
    const agentPromptInput = document.getElementById("agentPrompt");
    const agentChatResponseBody = document.getElementById("agentChatResponseBody");

    sendAgentPromptBtn.addEventListener("click", async () => {
      const prompt = agentPromptInput.value.trim();
      if (!prompt) {
        showToast("Chyb√≠ dotaz", "Napi≈°, co m√° agent udƒõlat.", true);
        return;
      }

      const statusBadge = document.getElementById("status-agent-chat");
      const statusDot = document.getElementById("status-dot-agent-chat");
      const statusText = document.getElementById("status-text-agent-chat");

      statusBadge.textContent = "Odes√≠l√°m‚Ä¶";
      statusDot.classList.add("offline");

      try {
        const data = await safeFetch(API_CONFIG.AGENT_CHAT_URL, {
          method: "POST",
          body: JSON.stringify({
                prompt,
                source: "admin.html"
                }),
        });

        // Oƒçek√°van√Ω form√°t:
        // { timestamp, severity, message, raw_response, ... }
        const msg =
          data.message ||
          data.raw ||
          "Agent odpovƒõdƒõl, ale zpr√°va nen√≠ ve standardn√≠m poli.";

        const entry = {
          timestamp: data.timestamp ?? new Date().toISOString(),
          severity: data.severity ?? "info",
          message: msg,
        };

        const item = document.createElement("div");
        item.className = "log-item";

        const badgeClass =
          entry.severity === "error"
            ? "error"
            : entry.severity === "warn"
            ? "warn"
            : "info";

        item.innerHTML = `
          <div class="log-meta">
            <span>${new Date(entry.timestamp).toLocaleString("cs-CZ")}</span>
            <span class="log-badge ${badgeClass}">${entry.severity.toUpperCase()}</span>
          </div>
          <div class="log-message">${entry.message}</div>
        `;

        agentChatResponseBody.innerHTML = "";
        agentChatResponseBody.appendChild(item);

        statusBadge.textContent = "P≈ôipraven";
        statusDot.classList.remove("offline", "error");
        statusText.textContent = "Dotaz byl √∫spƒõ≈°nƒõ odbaven agentem.";
        showToast("Odpovƒõƒè agenta", "Dotaz byl zpracov√°n.");
      } catch (err) {
        console.error(err);
        statusBadge.textContent = "Chyba";
        statusDot.classList.add("error");
        statusText.textContent =
          "Chyba p≈ôi vol√°n√≠ agenta ‚Äì zkontroluj URL, backend a CORS.";

        agentChatResponseBody.innerHTML =
          '<div class="log-item"><div class="log-message" style="color:#fecaca;">Nepoda≈ôilo se kontaktovat agenta. Zkontroluj nastaven√≠ n8n a CORS.</div></div>';

        showToast("Chyba API", err.message || String(err), true);
      }
    });

    // -------------------------------------------------------------------------
    // 6) Inicializace p≈ôi naƒçten√≠
    // -------------------------------------------------------------------------
    (function init() {
      // Na startu zkus√≠me naƒç√≠st existuj√≠c√≠ sloty a shrnut√≠ agenta
      loadSlots();
      loadAgentSummary();
      // Logy agenta st√°hne≈° ruƒçnƒõ kliknut√≠m ‚Äì a≈• to zbyteƒçnƒõ nevol√° dlouh√© dotazy
    })();
  </script>
</body>
</html>

